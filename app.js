// Exam Panel Application
class ExamPanel {
    constructor() {
        this.currentTab = '1ano';
        this.currentDate = new Date('2025-06-05');
        this.searchTerm = '';
        this.examData = {
            "provas_1ano": [
                {
                    "data": "2025-06-09",
                    "dia_semana": "Segunda",
                    "disciplinas": [
                        {
                            "nome": "Geografia",
                            "icone": "üåç",
                            "conteudo": ["Demografia e Geografia", "Dados Demogr√°ficos Estatais e Regionais (IBGE)"]
                        },
                        {
                            "nome": "Hist√≥ria", 
                            "icone": "üìú",
                            "conteudo": ["Egito; O Pa√≠s - Geografia", "As Fronteiras", "Riqueza Natural", "O Povo Eg√≠pcio", "A Escrita Eg√≠pcia", "Os Hieroglifos", "Divis√µes da Hist√≥ria Eg√≠pcia", "Egito Lend√°rio", "Egito Pr√©-Hist√≥rico", "Per√≠odo Tinita (Per√≠odo Arcaico)", "Antigo Imp√©rio", "As Pir√¢mides"]
                        }
                    ]
                },
                {
                    "data": "2025-06-10",
                    "dia_semana": "Ter√ßa",
                    "disciplinas": [
                        {
                            "nome": "Artes",
                            "icone": "üé®", 
                            "conteudo": ["Barroco e Maneirismo - Apostila"]
                        },
                        {
                            "nome": "Biologia",
                            "icone": "üß¨",
                            "conteudo": ["Ecologia: Rela√ß√µes Harm√≥nicas e Desarm√≥nicas", "Rela√ß√µes Harm√≥nicas Intraespecificas", "Rela√ß√µes Harm√¥nicas Interespec√≠ficas", "Rela√ß√µes Desarm√≥nicas", "Intraespecificas", "Rela√ß√µes Desarm√¥nicas Interespec√≠ficas", "Discuss√£o das Quest√µes do ENEM: Sustentabilidade", "Meio Ambientais", "Conserva√ß√£o da Biodiversidade e Mudan√ßas Clim√°ticas"]
                        },
                        {
                            "nome": "Literatura",
                            "icone": "üìö",
                            "conteudo": ["Barroco e arcadismo no Brasil"]
                        }
                    ]
                },
                {
                    "data": "2025-06-11",
                    "dia_semana": "Quarta",
                    "disciplinas": [
                        {
                            "nome": "Controladoria",
                            "icone": "üìä",
                            "conteudo": ["Margem de Contribui√ß√£o e Ponto de equil√≠brio"]
                        },
                        {
                            "nome": "Estat√≠stica",
                            "icone": "üìà",
                            "conteudo": ["Os n√∫meros n√£o mentem (at√© cap 7)"]
                        },
                        {
                            "nome": "Sistema Tribut√°rio",
                            "icone": "üí∞",
                            "conteudo": ["ISS - apostila e exerc√≠cios"]
                        }
                    ]
                },
                {
                    "data": "2025-06-12",
                    "dia_semana": "Quinta",
                    "disciplinas": [
                        {
                            "nome": "An√°lise Empresarial",
                            "icone": "üíº",
                            "conteudo": ["Contabilidade bimestral"]
                        },
                        {
                            "nome": "Catecismo",
                            "icone": "‚úùÔ∏è",
                            "conteudo": ["O Edito de Mil√£o", "as process√µes em Deus", "os Padres apologetas", "as heresias cristol√≥gicas", "o Arianismo e o Conc√≠lio de Nic√©ia", "S√£o Jer√¥nimo"]
                        },
                        {
                            "nome": "Reda√ß√£o",
                            "icone": "‚úçÔ∏è",
                            "conteudo": ["Tema trabalhado em sala de aula"]
                        }
                    ]
                },
                {
                    "data": "2025-06-13",
                    "dia_semana": "Sexta",
                    "disciplinas": [
                        {
                            "nome": "F√≠sica",
                            "icone": "‚ö°",
                            "conteudo": ["(N√£o especificado ainda)"]
                        },
                        {
                            "nome": "Ingl√™s",
                            "icone": "üá∫üá∏",
                            "conteudo": ["Trabalho em sala"]
                        }
                    ]
                },
                {
                    "data": "2025-06-16",
                    "dia_semana": "Segunda",
                    "disciplinas": [
                        {
                            "nome": "Matem√°tica",
                            "icone": "üî¢",
                            "conteudo": ["M√≥dulo (defini√ß√£o e propriedades)", "Fun√ß√£o modular", "Gr√°fico de fun√ß√£o modular"]
                        },
                        {
                            "nome": "Filosofia",
                            "icone": "ü§î",
                            "conteudo": ["Plat√£o - Apostila"]
                        },
                        {
                            "nome": "Tecnologia",
                            "icone": "üíª",
                            "conteudo": ["Uso de PROCV(), PROCH() e SEERRO()", "uso de f√≥rmulas referenciando a c√©lulas de outras planilhas", "chamadas de fun√ß√µes aninhadas"]
                        }
                    ]
                },
                {
                    "data": "2025-06-17",
                    "dia_semana": "Ter√ßa",
                    "disciplinas": [
                        {
                            "nome": "Sociologia",
                            "icone": "üë•",
                            "conteudo": ["An√°lise Sociopol√≠tica Internacional e Brasileira", "Conflitos econ√¥micos e militares mundiais", "Sociologia aplicada ao Vestibular"]
                        },
                        {
                            "nome": "Empreendedorismo",
                            "icone": "üöÄ",
                            "conteudo": ["An√°lise do Projeto de Cantina Escolar como Estrat√©gia de Educa√ß√£o Empreendedora e Forma√ß√£o para o Projeto de Vida"]
                        }
                    ]
                },
                {
                    "data": "2025-06-18",
                    "dia_semana": "Quarta",
                    "disciplinas": [
                        {
                            "nome": "Qu√≠mica",
                            "icone": "‚öóÔ∏è",
                            "conteudo": ["Distribui√ß√£o eletr√¥nica: √°tomos neutros, c√°tions e √¢nions", "Propriedades peri√≥dicas", "Liga√ß√£o i√¥nica, covalente e met√°lica", "Polaridade e geometria qu√≠mica"]
                        },
                        {
                            "nome": "Gram√°tica",
                            "icone": "üìù",
                            "conteudo": ["Adjetivos e artigos", "Numerais"]
                        }
                    ]
                }
            ],
            "provas_5ano": [
                {
                    "data": "2025-06-09",
                    "dia_semana": "Segunda",
                    "disciplinas": [
                        {
                            "nome": "Hist√≥ria",
                            "icone": "üìú",
                            "conteudo": ["Independ√™ncia do Brasil", "Dom Pedro I"]
                        }
                    ]
                },
                {
                    "data": "2025-06-10",
                    "dia_semana": "Ter√ßa",
                    "disciplinas": [
                        {
                            "nome": "Reda√ß√£o",
                            "icone": "‚úçÔ∏è",
                            "conteudo": ["Tema trabalhado em sala de aula"]
                        }
                    ]
                },
                {
                    "data": "2025-06-11",
                    "dia_semana": "Quarta",
                    "disciplinas": [
                        {
                            "nome": "Portugu√™s",
                            "icone": "üìö",
                            "conteudo": ["Tipos de substantivos", "g√™nero, n√∫mero e grau dos substantivos", "Adjetivos e seus graus", "Numeral"]
                        }
                    ]
                },
                {
                    "data": "2025-06-12",
                    "dia_semana": "Quinta",
                    "disciplinas": [
                        {
                            "nome": "Artes",
                            "icone": "üé®",
                            "conteudo": ["Trabalho em sala"]
                        },
                        {
                            "nome": "Geografia",
                            "icone": "üåç",
                            "conteudo": ["Divis√£o Pol√≠tica do Brasil", "Divis√£o do territ√≥rio brasileiro", "Estados das Regi√µes do Brasil", "O clima no Brasil", "O relevo brasileiro", "Litoral brasileiro"]
                        }
                    ]
                },
                {
                    "data": "2025-06-13",
                    "dia_semana": "Sexta",
                    "disciplinas": [
                        {
                            "nome": "Catecismo",
                            "icone": "‚úùÔ∏è",
                            "conteudo": ["6¬∞, 7¬∞, 8¬∞, 9¬∞, 10¬∞, 11¬∞ artigos do Credo", "o Juizo Final", "o Esp√≠rito Santo", "a Igreja Catolica", "os Tr√™s Estados da Igreja", "a Comunh√£o dos Santos", "o Purgat√≥rio e os Novissimos"]
                        }
                    ]
                },
                {
                    "data": "2025-06-16",
                    "dia_semana": "Segunda",
                    "disciplinas": [
                        {
                            "nome": "Ingl√™s",
                            "icone": "üá∫üá∏",
                            "conteudo": ["Vocabul√°rio do cotidiano"]
                        },
                        {
                            "nome": "Franc√™s",
                            "icone": "üá´üá∑",
                            "conteudo": ["il y a e C'est", "partes do corpo"]
                        }
                    ]
                },
                {
                    "data": "2025-06-17",
                    "dia_semana": "Ter√ßa",
                    "disciplinas": [
                        {
                            "nome": "Ci√™ncias",
                            "icone": "üî¨",
                            "conteudo": ["Cadeias e Teias Alimentares"]
                        }
                    ]
                },
                {
                    "data": "2025-06-18",
                    "dia_semana": "Quarta",
                    "disciplinas": [
                        {
                            "nome": "Matem√°tica",
                            "icone": "üî¢",
                            "conteudo": ["Decimais (4 opera√ß√µes)", "multiplica√ß√£o e divis√£o por 10, 100, 1000", "Transforma√ß√µes de unidades (metro, grama, hora)", "M√∫ltiplos e divisores", "MMC, MDC", "N√∫meros primos", "Metade, dobro, triplo, d√∫zia e meia d√∫zia", "Problemas"]
                        }
                    ]
                }
            ]
        };
        
        this.init();
    }

    init() {
        this.setupEventListeners();
        this.renderExams();
    }

    setupEventListeners() {
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchTab(e.target.dataset.tab);
            });
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearSearch');

        searchInput.addEventListener('input', (e) => {
            this.searchTerm = e.target.value.toLowerCase();
            this.updateClearButton();
            this.renderExams();
        });

        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            this.searchTerm = '';
            this.updateClearButton();
            this.renderExams();
            searchInput.focus();
        });
    }

    switchTab(tabName) {
        // Update active tab button
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

        // Update active content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`content-${tabName}`).classList.add('active');

        this.currentTab = tabName;
        this.renderExams();
    }

    updateClearButton() {
        const clearBtn = document.getElementById('clearSearch');
        if (this.searchTerm) {
            clearBtn.classList.add('visible');
        } else {
            clearBtn.classList.remove('visible');
        }
    }

    getExamStatus(examDate) {
        const exam = new Date(examDate);
        const current = new Date(this.currentDate);
        const diffTime = exam.getTime() - current.getTime();
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 0) return { class: 'today', text: 'Hoje' };
        if (diffDays === 1) return { class: 'tomorrow', text: 'Amanh√£' };
        if (diffDays > 1 && diffDays <= 7) return { class: 'this-week', text: 'Esta Semana' };
        return { class: 'future', text: 'Futuro' };
    }

    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
    }

    filterExams(exams) {
        if (!this.searchTerm) return exams;

        return exams.filter(exam => {
            // Search in date
            if (this.formatDate(exam.data).includes(this.searchTerm)) return true;
            if (exam.dia_semana.toLowerCase().includes(this.searchTerm)) return true;

            // Search in disciplines
            return exam.disciplinas.some(disciplina => {
                if (disciplina.nome.toLowerCase().includes(this.searchTerm)) return true;
                return disciplina.conteudo.some(conteudo => 
                    conteudo.toLowerCase().includes(this.searchTerm)
                );
            });
        });
    }

    createSubjectCard(disciplina) {
        const subjectCard = document.createElement('div');
        subjectCard.className = 'subject-card';
        
        const contentItems = disciplina.conteudo.map(item => 
            `<div class="content-item">${item}</div>`
        ).join('');

        subjectCard.innerHTML = `
            <div class="subject-header">
                <div class="subject-icon">${disciplina.icone}</div>
                <div class="subject-name">${disciplina.nome}</div>
                <div class="expand-indicator">‚ñº</div>
            </div>
            <div class="subject-content">
                <div class="content-list">
                    ${contentItems}
                </div>
            </div>
        `;

        // Add click event to expand/collapse
        subjectCard.addEventListener('click', () => {
            subjectCard.classList.toggle('expanded');
        });

        return subjectCard;
    }

    createExamCard(exam) {
        const examCard = document.createElement('div');
        examCard.className = 'exam-day bounce-in';
        
        const status = this.getExamStatus(exam.data);
        const formattedDate = this.formatDate(exam.data);

        examCard.innerHTML = `
            <div class="exam-day-header">
                <div class="exam-status ${status.class}">${status.text}</div>
                <div class="exam-date">${formattedDate}</div>
                <div class="exam-weekday">${exam.dia_semana}-feira</div>
            </div>
            <div class="subjects-list">
                <!-- Subjects will be added dynamically -->
            </div>
        `;

        const subjectsList = examCard.querySelector('.subjects-list');
        exam.disciplinas.forEach(disciplina => {
            const subjectCard = this.createSubjectCard(disciplina);
            subjectsList.appendChild(subjectCard);
        });

        return examCard;
    }

    renderExams() {
        const examKey = this.currentTab === '1ano' ? 'provas_1ano' : 'provas_5ano';
        const exams = this.examData[examKey];
        const filteredExams = this.filterExams(exams);
        
        const container = document.getElementById(`exams-${this.currentTab}`);
        const noResults = document.getElementById('noResults');
        
        // Clear existing content
        container.innerHTML = '';

        if (filteredExams.length === 0) {
            noResults.classList.remove('hidden');
            return;
        }

        noResults.classList.add('hidden');

        // Create and append exam cards
        filteredExams.forEach((exam, index) => {
            const examCard = this.createExamCard(exam);
            // Add staggered animation delay
            examCard.style.animationDelay = `${index * 0.1}s`;
            container.appendChild(examCard);
        });
    }
}

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    new ExamPanel();
});

// Add some utility functions for enhanced user experience
document.addEventListener('keydown', (e) => {
    // ESC key to clear search
    if (e.key === 'Escape') {
        const searchInput = document.getElementById('searchInput');
        if (searchInput.value) {
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input'));
        }
    }
    
    // Ctrl/Cmd + K to focus search
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('searchInput').focus();
    }
});

// Add smooth scrolling when jumping between sections
function smoothScrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// Handle tab keyboard navigation
document.querySelectorAll('.tab-btn').forEach((tab, index, tabs) => {
    tab.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' && index > 0) {
            tabs[index - 1].focus();
        } else if (e.key === 'ArrowRight' && index < tabs.length - 1) {
            tabs[index + 1].focus();
        }
    });
});

// Add loading state management
function showLoading() {
    document.body.classList.add('loading');
}

function hideLoading() {
    document.body.classList.remove('loading');
}

// Performance optimization: Intersection Observer for animations
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const cardObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('fade-in');
        }
    });
}, observerOptions);

// Observe cards as they're added to the DOM
const mutationObserver = new MutationObserver((mutations) => {
    mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
            if (node.nodeType === 1 && node.classList.contains('exam-day')) {
                cardObserver.observe(node);
            }
        });
    });
});

mutationObserver.observe(document.body, {
    childList: true,
    subtree: true
});